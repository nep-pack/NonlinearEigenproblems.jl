language: julia
os:
  - linux
julia:
  - 0.6
notifications:
  email: false
cache:
  directories:
  # cache all packages
  - $HOME/.julia
script:
  # remove cache of our own package
  - rm -rf $HOME/.julia/v0.6/NonlinearEigenproblems
  - git fetch --unshallow
  - julia --color=yes -e 'Pkg.clone(pwd())'
  - julia --color=yes -e 'Pkg.build("NonlinearEigenproblems")'
  # delete old test coverage results
  - find $HOME/.julia -name '*.jl.*cov' -delete
  # filter out "method definition overwritten" warnings
  - "julia --check-bounds=yes --color=yes -e 'Pkg.test(\"NonlinearEigenproblems\", coverage=true)' 2> >(grep -v \"WARNING: Method definition.\\+overwritten\")"
before_cache:
  # add Coverage package to cache, so that we don't have to install it on each run
  - julia -e 'Pkg.add("Coverage");'
after_success:
  - julia -e 'cd(Pkg.dir("NonlinearEigenproblems")); using Coverage; Coveralls.submit(Coveralls.process_folder())'
  - julia -e 'cd(Pkg.dir("NonlinearEigenproblems")); using Coverage; Codecov.submit(Codecov.process_folder())'
